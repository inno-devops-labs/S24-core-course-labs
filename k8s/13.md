## Rename deployment.yaml file into statefulset.yml

1) Changed values.yaml file
2) Fix ingress.yaml

Run command for check new build

```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> helm install --dry-run --debug release-name .
install.go:224: 2024-11-16 18:50:40.5933913 +0300 MSK m=+0.094861501 [debug] Original chart version: ""
install.go:241: 2024-11-16 18:50:40.5933913 +0300 MSK m=+0.094861501 [debug] CHART PATH: C:\Users\Ernest\Desktop\Matskevich\k8s\python-app

NAME: release-name
LAST DEPLOYED: Sat Nov 16 18:50:40 2024
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
autoscaling:
  enabled: false
  maxReplicas: 5
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
image:
  repository: ernestmatskevich/moscow-time
  tag: latest
ingress:
  annotations: {}
  className: ""
  enabled: true
  hosts:
  - host: example.local
    paths:
    - path: /
      pathType: Prefix
  tls: []
replicas: 1
service:
  port: 5000
serviceAccount:
  create: true
storage:
  size: 1Gi

HOOKS:
---
# Source: python-app/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "release-name-python-app-test-connection"
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['release-name-python-app:5000']
  restartPolicy: Never
MANIFEST:
---
# Source: python-app/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: release-name-python-app
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken:
---
# Source: python-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-python-app
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type:
  ports:
    - port: 5000
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
---
# Source: python-app/templates/deployment.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: release-name-python-app
  labels:
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
spec:
  serviceName: "release-name-service"
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: python-app
      app.kubernetes.io/instance: release-name
  template:
    metadata:
      labels:
        app.kubernetes.io/name: python-app
        app.kubernetes.io/instance: release-name
    spec:
      containers:
        - name: python-app
          image: ernestmatskevich/moscow-time:latest
          ports:
            - containerPort: 5000
          volumeMounts:
            - name: app-storage
              mountPath: /data
  volumeClaimTemplates:
    - metadata:
        name: app-storage
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 1Gi
---
# Source: python-app/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: release-name-python-app
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  rules:
    - host: "example.local"
      http:
        paths:
          - path: /
            backend:
                port:
                  number: 5000

NOTES:
1. Get the application URL by running these commands:

```

Then save its template to output.yaml file

```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> helm template release-name . > output.yaml
```

Then apply its template

```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> kubectl apply -f output.yaml
service/release-name-python-app created
statefulset.apps/release-name-python-app created
```

Get pods, svc

```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> kubectl get pods
NAME                                       READY   STATUS      RESTARTS   AGE
release-name-python-app-0                  1/1     Running     0          34s
release-name-python-app-765cdf987f-8784p   1/1     Running     0          48m
release-name-python-app-test-connection    0/1     Completed   0          48m
```
```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> kubectl get svc
NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
kubernetes                ClusterIP   10.96.0.1        <none>        443/TCP    14h
release-name-python-app   ClusterIP   10.104.127.175   <none>        5000/TCP   49s
```

Get ingress
```bash
(venv) PS C:\Users\Ernest\Desktop\Matskevich\k8s\python-app> kubectl get ingress
NAME                      CLASS    HOSTS           ADDRESS   PORTS   AGE
release-name-python-app   <none>   example.local             80      58s
```